DROP TABLE IF EXISTS curso_aluno CASCADE;
DROP TABLE IF EXISTS aula CASCADE;
DROP TABLE IF EXISTS curso CASCADE;
DROP TABLE IF EXISTS usuario CASCADE;
DROP TABLE IF EXISTS pessoa CASCADE;
DROP TABLE IF EXISTS endereco CASCADE;
DROP TABLE IF EXISTS telefone CASCADE;
DROP TABLE IF EXISTS pagamento CASCADE;
DROP TABLE IF EXISTS pessoa_endereco CASCADE;
DROP TABLE IF EXISTS pessoa_telefone CASCADE;


CREATE TABLE usuario (
	id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
	nome VARCHAR(100) NOT NULL,
	email VARCHAR(100) NOT NULL
);

ALTER TABLE usuario ADD CONSTRAINT pk_usuario PRIMARY KEY (id);
ALTER TABLE usuario ADD CONSTRAINT uk_usuario UNIQUE (email);

CREATE TABLE curso(
	id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
	titulo VARCHAR(50) NOT NULL,
	tipo VARCHAR(50) NOT NULL,
	nivel VARCHAR(50) NOT NULL,
	ativo BOOLEAN NOT NULL,
	data_inicio DATE NOT NULL
);

ALTER TABLE curso ADD CONSTRAINT pk_curso PRIMARY KEY(id);
ALTER TABLE curso ADD CONSTRAINT uk_curso_titulo UNIQUE(titulo);
ALTER TABLE curso ADD CONSTRAINT ck_curso_tipo CHECK (tipo IN('PRESENCIAL', 'EAD'));
ALTER TABLE curso ADD CONSTRAINT ck_curso_nivel CHECK (nivel in ('INICIANTE', 'INTERMEDIARIO', 'AVANÃ‡ADO'));

CREATE TABLE aula(
	id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
	titulo VARCHAR(50) NOT NULL,
	descricao VARCHAR(100),
	curso_id BIGINT NOT NULL,
	instrutor_id BIGINT NOT NULL
);

ALTER TABLE aula ADD CONSTRAINT pk_aula PRIMARY KEY(id);
ALTER TABLE aula ADD CONSTRAINT fk_aula_curso FOREIGN KEY (curso_id) REFERENCES curso;
ALTER TABLE aula ADD CONSTRAINT fk_aula_instrutor FOREIGN KEY (instrutor_id) REFERENCES usuario;

CREATE TABLE curso_aluno(
	id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
	curso_id BIGINT NOT NULL,
	aluno_id BIGINT NOT NULL
);

ALTER TABLE curso_aluno ADD CONSTRAINT pk_curso_aluno PRIMARY KEY(id);
ALTER TABLE curso_aluno ADD CONSTRAINT uk_curso_aluno UNIQUE (curso_id, aluno_id);
ALTER TABLE curso_aluno ADD CONSTRAINT fk_curso_aluno_curso FOREIGN KEY (curso_id) REFERENCES curso;
ALTER TABLE curso_aluno ADD CONSTRAINT fk_curso_aluno_aluno FOREIGN KEY (aluno_id) REFERENCES usuario;

CREATE TABLE pessoa(
	id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
	nome VARCHAR(100) NOT NULL
);

ALTER TABLE pessoa ADD CONSTRAINT pk_pessoa PRIMARY KEY (id);

CREATE TABLE endereco(
	id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
	descricao VARCHAR(200) NOT NULL
);

ALTER TABLE endereco ADD CONSTRAINT pk_endereco PRIMARY KEY (id);

CREATE TABLE telefone(
	id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
	numero VARCHAR(11) NOT NULL,
	pessoa_id BIGINT NOT NULL
);

ALTER TABLE telefone ADD CONSTRAINT pk_telefone PRIMARY KEY (id);
ALTER TABLE telefone ADD CONSTRAINT fk_telefone_pessoa FOREIGN KEY (pessoa_id) references pessoa;

CREATE TABLE pagamento(
	id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
	valor DECIMAL NOT NULL,
	pessoa_pagamento_id BIGINT NOT NULL
);

ALTER TABLE pagamento ADD CONSTRAINT pk_pagamento PRIMARY KEY (id);
ALTER TABLE pagamento ADD CONSTRAINT fk_pagamento_pessoa FOREIGN KEY (pessoa_pagamento_id) references pessoa;


CREATE TABLE pessoa_endereco(
	id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
	pessoa_id BIGINT NOT NULL,
	endereco_id BIGINT NOT NULL
);

ALTER TABLE pessoa_endereco ADD CONSTRAINT pk_pessoa_endereco PRIMARY KEY (id);
ALTER TABLE pessoa_endereco ADD CONSTRAINT fk_pessoa_endereco_pessoa FOREIGN KEY (pessoa_id) references pessoa;
ALTER TABLE pessoa_endereco ADD CONSTRAINT fk_pessoa_endereco_endereco FOREIGN KEY (endereco_id) references endereco;
